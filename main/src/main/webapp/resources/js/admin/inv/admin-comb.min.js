/*2016-09-23 11:14 AM*/

var inventoryRouter=function($routeProvider){$routeProvider.when("/products/add-products",{templateUrl:"/resources/ng-templates/admin/inv/views/add-products.html"+versionCtrl,controller:"addProductsCtrl"}).when("/products/add-categories",{templateUrl:"/resources/ng-templates/admin/inv/views/add-categories.html"+versionCtrl,controller:"addCategoryCtrl"}).when("/products/add-strains",{templateUrl:"/resources/ng-templates/admin/inv/views/add-strains.html"+versionCtrl,controller:"addStrainsCtrl"}).when("/add-people",{templateUrl:"/resources/ng-templates/admin/inv/views/add-people.html"+versionCtrl,controller:"addPplCtrl"}).when("/purchases",{templateUrl:"/resources/ng-templates/admin/inv/views/purchases.html"+versionCtrl,controller:"addPurchaseCtrl"}).when("/packets",{templateUrl:"/resources/ng-templates/admin/inv/views/packets.html"+versionCtrl,controller:"addPacketCtrl"}).when("/inventory/box-inventory",{templateUrl:"/resources/ng-templates/admin/inv/views/box-inventory.html"+versionCtrl,controller:"addBoxInvCtrl"}).when("/inventory/shop-inventory",{templateUrl:"/resources/ng-templates/admin/inv/views/shop-inventory.html"+versionCtrl,controller:"shopInvCtrl"}).when("/settings/logs",{templateUrl:"/resources/ng-templates/admin/inv/views/logs.html"+versionCtrl,controller:"logCtrl"}).when("/settings/returns",{templateUrl:"/resources/ng-templates/admin/inv/views/returns.html"+versionCtrl,controller:"returnsCtrl"}).when("/settings/bulk-shop-assign",{templateUrl:"/resources/ng-templates/admin/inv/views/bulk-assign.html"+versionCtrl,controller:"bulkAssignCtrl"}).when("/settings/barcodes",{templateUrl:"/resources/ng-templates/admin/inv/views/generate-barcode.html"+versionCtrl,controller:"barCodeCtrl"}).when("/settings/stats",{templateUrl:"/resources/ng-templates/admin/inv/views/stats.html"+versionCtrl,controller:"statsCtrl"}).when("/inventory/inv-alert-settings",{templateUrl:"/resources/ng-templates/admin/inv/views/inv-alerts.html"+versionCtrl,controller:"invAlertCtrl"}).when("/inventory/take-stock",{templateUrl:"/resources/ng-templates/admin/inv/views/stock-taking.html"+versionCtrl,controller:"stockTakeCtrl"}).when("/inventory/misc",{templateUrl:"/resources/ng-templates/admin/inv/views/misc-report.html"+versionCtrl,controller:"miscReportCtrl"}).otherwise({redirectTo:"/purchases"})},ModalAssignDrvInstanceCtrlr=function($scope,$uibModalInstance,drivers,order){$scope.drivers=drivers,$scope.driverSelected=$scope.drivers[0],$scope.order=order,$scope.ok=function(){$scope.order.dispatch.driverName=$scope.driverSelected.driverName;var sendBack={order:$scope.order,driverId:$scope.driverSelected.id};$uibModalInstance.close(sendBack)},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}},barCodeCtrlr=function($scope,$http,$rootScope){$rootScope.rootPage="Bar Codes",$scope.controlId=_luvbriteGlobalOpsId,$scope.controlId>100||($scope.noOfSheets=1,$scope.startingNumber=0,$scope.barcodePrefix="",$scope.skip=0,$scope.products=[],$scope.prodSelected={id:0,productName:"Select Product"},$http.get("/inventory/apps/listallprods").success(function(data){data.success&&($scope.products=data.result,$scope.products.unshift($scope.prodSelected))}),$scope.getNextValue=function(){$http.get("/inventory/apps/listbcis").success(function(data){data.success&&($scope.startingNumber=data.result[0].nextValue,$scope.barcodePrefix=data.result[0].barcodePrefix)})},$scope.getNextValue(),$scope.generatePDF=function(){window.location="/inventory/apps/getbarcode?sn="+$scope.startingNumber+"&ns="+$scope.noOfSheets+"&opsid="+_luvbriteGlobalOpsId},$scope.prodList=[],$scope.addObjs=function(){$scope.prodList.push($scope.prodSelected)},$scope.removeObj=function(){for(var currProd=this.item,i=0;i<$scope.prodList.length;i++)if($scope.prodList[i]==currProd){$scope.prodList.splice(i,1);break}},$scope.generateAllPrdBarcodes=function(){window.location="/inventory/apps/getproductbarcode?skip="+$scope.skip},$scope.generatePrdBarcodes=function(){var objs=[];$scope.prodList.forEach(function(prod,index){objs.push(prod.id+"~"+prod.productName)}),window.location="/inventory/apps/getproductbarcode?skip="+$scope.skip+"&objs="+objs.join()})},addBoxInvCtrlr=function($scope,$http,$routeParams){$rootScope.rootPage="Box Inventory",$scope.controlId=_luvbriteGlobalOpsId,$scope.currentboxId=0,$scope.boxInvs=[],$scope.items=[{value:"in",label:"In the Box"},{value:"sold",label:"Sold"},{value:"",label:"All Types"}],$scope.itemSelected=$scope.items[0],$routeParams&&$routeParams.b&&($scope.currentboxId=$routeParams.b),$scope.boxSelected={id:0,boxName:"All Boxes"},$scope.boxes=[],$http.get("/inventory/apps/listboxes").success(function(data){data.success&&($scope.boxes=data.result,$scope.boxes.unshift($scope.boxSelected))}),$scope.boxChange=function(){$scope.currentboxId=$scope.boxSelected.id,$scope.getboxInventory()},$scope.getboxInventory=function(){var urlParams="?b="+$scope.currentboxId+"&it="+$scope.itemSelected.value;$http.get("/inventory/apps/listboxinv"+urlParams).success(function(data){data.success&&($scope.boxInvs=data.result)})},$scope.getboxInventory()},bulkAssignCtrlr=function($scope,$http,$rootScope){$rootScope.rootPage="Bulk Assign",$scope.controlId=_luvbriteGlobalOpsId,$scope.controlId>100||($scope.packetCode="",$scope.btnTxt="ADD",$scope.newpackets=[],$scope.sortCtrl=100,$scope.shopSelected={},$http.get("/inventory/apps/listshops").success(function(data){data.success&&($scope.shops=data.result)}),$scope.addPacket=function(){for(var proceed=!0,i=0;i<$scope.newpackets.length;i++)if($scope.newpackets[i].packetCode==$scope.packetCode){alert("This packet has been already scanned"),proceed=!1;break}proceed&&($scope.newpackets.push({packetCode:$scope.packetCode,productName:"",sort:$scope.sortCtrl++}),$scope.btnTxt="Adding...",$.post("/inventory/apps/updatepacket",{pc:$scope.packetCode,sp:$scope.shopSelected.id,mode:"assignshop",opsid:_luvbriteGlobalOpsId},function(data){if($scope.btnTxt="ADD",data.success){$scope.packetCode="",$("#packetCode").focus();for(var i=0;i<$scope.newpackets.length;i++)if($scope.newpackets[i].packetCode==data.packet.packetCode){$scope.newpackets[i].productName=data.packet.productName;try{$scope.$apply()}catch(err){}break}}else alert(data.message)}))},$scope.shopFilter=function(){$scope.reload(),$scope.newpackets=[]},$scope.pg={currentPage:1,endCount:0,itemsPerPage:0,startCount:0,totalItems:0},$scope.sortBy="",$scope.sdir="ASC",$scope.pageChanged=function(){$scope.reload()},$scope.packets=[],$scope.reload=function(){var urlParams="?cpage="+$scope.pg.currentPage+"&sp="+$scope.shopSelected.id;$http.get("/inventory/apps/listpackets"+urlParams).success(function(data){data.success&&($scope.packets=data.result,data.pg&&($scope.pg=data.pg),$scope.purchaseSpecific&&$scope.packets.length>0&&($scope.productName=$scope.packets[0].productName))})})},addCategoryCtrlr=function($scope,$http,$filter,$rootScope){$rootScope.rootPage="Categories",$scope.controlId=_luvbriteGlobalOpsId,$scope.currentCategoryId=0,$scope.btnText="ADD",$scope.categories=[],$http.get("/inventory/apps/listcats").success(function(data){data.success&&($scope.categories=data.result)}),$scope.addCategory=function(){if(0!=$scope.currentCategoryId){for(var i=0;i<$scope.categories.length;i++)if($scope.categories[i].id==$scope.currentCategoryId){$scope.categories[i].categoryName=$scope.categoryName;break}$.post("/inventory/apps/updatecat",{id:$scope.currentCategoryId,cn:$scope.categoryName,opsid:_luvbriteGlobalOpsId},function(data){data.success||alert(data.message)}),$scope.currentCategoryId=0,$scope.categoryName="",$scope.btnText="ADD"}else $scope.categories.push({categoryName:$scope.categoryName,formattedDateAdded:$filter("date")(new Date,"MM/dd/yyyy hh:mm a")}),$.post("/inventory/apps/newcat",{cn:$scope.categoryName,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.categories.length;i++)if($scope.categories[i].categoryName==data.cat.categoryName){$scope.categories[i]=data.cat;try{$scope.$apply()}catch(err){}break}}else alert(data.message)}),$scope.categoryName=""},$scope.editCategory=function($event){$event.preventDefault(),$scope.categoryName=this.category.categoryName,$scope.currentCategoryId=this.category.id,$scope.btnText="SAVE",_lbFns.showViewForm()},$scope.cancelEdit=function($event){$event.preventDefault(),$scope.currentCategoryId=0,$scope.categoryName="",$scope.btnText="ADD"}},invAlertCtrlr=function($scope,$http,$rootScope){$rootScope.rootPage="Inv Alert",$scope.controlId=_luvbriteGlobalOpsId,$scope.controlId>100||($scope.productSearch="",$scope.alerts=[],$http.get("/inventory/apps/invalert/list").success(function(data){data.success&&data.result.length>0&&($scope.alerts=data.result)}),$scope.showSave=function(){$(event.target).parents(".inv-alert-rows").find("a.inv-save-alert .glyphicon").fadeIn()},$scope.saveAlert=function(){var item=this.alert;$scope.elem=$(event.target),$scope.elem.attr("class","glyphicon glyphicon-floppy-open"),$http.get("/inventory/apps/invalert/update",{params:{id:item.productId,af:item.alertActive,al:item.amberLevel,wl:item.redLevel,opsid:_luvbriteGlobalOpsId}}).success(function(res){res.success?$scope.elem.attr("class","glyphicon glyphicon-floppy-saved").fadeOut(1500,function(){$(this).attr({class:"glyphicon glyphicon-floppy-disk"})}):alert(res.message)}).error(function(){alert("There was some error removing the return.")})})},logCtrlr=function($scope,$http,$rootScope){$rootScope.rootPage="Tracking Logs",$scope.controlId=_luvbriteGlobalOpsId,$scope.controlId>100||($scope.accessGranted=!0,$scope.operatorSelected={operatorName:"All Operators",id:0},$scope.driverSelected={driverName:"All Drivers",id:0},$http.get("/inventory/apps/listdrivers").success(function(data){data.success&&($scope.drivers=data.result,$scope.drivers.unshift($scope.driverSelected))}),$http.get("/inventory/apps/listops").success(function(data){data.success&&($scope.operators=data.result,$scope.operators.unshift($scope.operatorSelected))}),$scope.actionObjs=[{value:"",label:"All Objects"},{value:"shops",label:"Shops"},{value:"packet",label:"Packets"},{value:"cat",label:"Categories"},{value:"ops",label:"Operators"},{value:"prod",label:"Products"},{value:"strain",label:"Strains"},{value:"vendor",label:"Vendors"},{value:"purchase",label:"Purchases"},{value:"clients",label:"Clients"},{value:"drivers",label:"Drivers"}],$scope.actionObjSelected=$scope.actionObjs[0],$scope.pg={currentPage:1,endCount:0,itemsPerPage:0,startCount:0,totalItems:0},$scope.sortBy="",$scope.sdir="ASC",$scope.logs=[],$scope.pageChanged=function(){$scope.reload()},$scope.sortCol=function(param,e){$scope.sortBy=param;var $currentTarget=$(e.currentTarget);$currentTarget.hasClass("sdir-asc")?($scope.sdir="DESC",$(".sdir-asc,.sdir-desc").removeClass("sdir-desc sdir-asc"),$currentTarget.addClass("sdir-desc")):($scope.sdir="ASC",$(".sdir-asc,.sdir-desc").removeClass("sdir-desc sdir-asc"),$currentTarget.addClass("sdir-asc")),$scope.reload()},$scope.driverFilter=function(){$scope.operatorSelected=$scope.operators[0],$scope.reload()},$scope.operatorFilter=function(){$scope.driverSelected=$scope.drivers[0],$scope.reload()},$scope.reload=function(){var urlParams="?cpage="+$scope.pg.currentPage+"&op="+$scope.operatorSelected.id+"&dr="+$scope.driverSelected.id+"&obj="+$scope.actionObjSelected.value+"&sort="+$scope.sortBy+"&sdir="+$scope.sdir;$http.get("/inventory/apps/listtracker"+urlParams).success(function(data){data.success&&($scope.logs=data.result,data.pg&&($scope.pg=data.pg))})},$scope.reload())},miscReportCtrlr=function($scope,$http,$rootScope){$rootScope.rootPage="Bar Codes",$scope.controlId=_luvbriteGlobalOpsId,$scope.controlId>100||($scope.alertTxt="",$scope.sku="",$scope.totalItems=14,$scope.currentPage=1,$scope.itemsPerPage=4,$scope.pg={currentPage:1,endCount:0,itemsPerPage:0,startCount:0,totalItems:0},$scope.sortBy="date",$scope.sdir="DESC",$scope.pageChanged=function(){$scope.reload()},$scope.sortCol=function(param,e){sortColFns($scope,param,e)},$scope.packets=[],$scope.reload=function(){$scope.alertTxt="";var urlParams="?cpage="+$scope.pg.currentPage+"&sort="+$scope.sortBy+"&sdir="+$scope.sdir+"&allmisc=true&pc="+$scope.sku;$http.get("/inventory/apps/listpackets"+urlParams).success(function(data){data.success&&($scope.packets=data.result,data.pg&&($scope.pg=data.pg))})},$scope.reload())},addPacketCtrlr=function($scope,$http,$routeParams,driverMode,$uibModal,$rootScope){$rootScope.rootPage="Packets",$scope.controlId=_luvbriteGlobalOpsId,$scope.controlId>100||($scope.alertTxt="",$scope.packetBtnText="ADD",$scope.currentPacketId=0,$scope.purchaseId=0,$scope.productName="",$scope.purchaseSpecific=!1,$scope.totalItems=14,$scope.currentPage=1,$scope.itemsPerPage=4,$routeParams&&$routeParams.p&&($scope.purchaseId=$routeParams.p,$scope.purchaseSpecific=!0,$(".packetID").focus()),$scope.driverMode=driverMode,$scope.shopSelected1={id:"-1",shopName:"All Shops"},$scope.shops=[],$scope.shops1=[],$http.get("/inventory/apps/listshops").success(function(data){data.success&&($scope.shops=data.result,$scope.shops1=data.result.slice(),$scope.driverMode?$scope.shopSelected1=$scope.shops1[0]:$scope.shops1.unshift($scope.shopSelected1))}),$scope.items=[{value:"all",label:"All Units"},{value:"ns",label:"Not Sold"},{value:"sold",label:"Sold"}],$scope.itemSelected=$scope.items[0],$scope.sku="",$scope.addPacket=function(){var currPacketId=$scope.currentPacketId,currPacketCode=$scope.packetCode,currWeightInGrams=$scope.weightInGrams,currMarkedPrice=$scope.markedPrice;if(0!=$scope.currentPacketId)$.post("/inventory/apps/updatepacket",{mode:"basic",id:$scope.currentPacketId,pc:$scope.packetCode,wt:$scope.weightInGrams,price:$scope.markedPrice,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.packets.length;i++)if($scope.packets[i].id==currPacketId){$scope.packets[i].packetCode=currPacketCode,$scope.packets[i].weightInGrams=currWeightInGrams,$scope.packets[i].markedPrice=currMarkedPrice;break}$scope.currentPacketId=0,$scope.weightInGrams="",$scope.markedPrice="",$scope.packetCode="",$scope.packetBtnText="ADD"}else $scope.alertTxt=data.message;try{$scope.$apply()}catch(err){}$scope.purchaseSpecific&&$(".packetID").focus(),$scope.refreshPurchaseInfo()});else{for(var packetPresent=!1,currPacketCode=$scope.packetCode,i=0;i<$scope.packets.length;i++)if($scope.packets[i].packetCode==$scope.packetCode){packetPresent=!0;break}if(packetPresent)return void($scope.alertTxt="Packet already scanned!");$scope.packets.push({productName:$scope.productName,packetCode:$scope.packetCode,weightInGrams:$scope.weightInGrams,markedPrice:$scope.markedPrice,returnReason:"",returnDetailsId:0}),$.post("/inventory/apps/newpacket",{pi:$scope.purchaseId,wt:$scope.weightInGrams,price:$scope.markedPrice,pc:$scope.packetCode,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.packets.length;i++)if($scope.packets[i].packetCode==data.packet.packetCode){$scope.packets[i].dateAdded=data.packet.dateAdded,$scope.packets[i].id=data.packet.id;try{$scope.$apply()}catch(err){}break}$scope.currentPacketId=0,$scope.packetCode="",$(".packetID").focus(),$scope.refreshPurchaseInfo()}else{$scope.alertTxt=data.message;for(var i=0;i<$scope.packets.length;i++)if($scope.packets[i].packetCode==currPacketCode){$scope.packets.splice(i,1);try{$scope.$apply()}catch(err){}break}}})}},$scope.deletePacket=function(){var currentPacketId=this.packet.id;confirm("Are you sure you want to delete this item?")&&$.post("/inventory/apps/updatepacket",{mode:"delete",id:currentPacketId,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.packets.length;i++)if($scope.packets[i].id==data.packet.id){$scope.packets.splice(i,1);try{$scope.$apply()}catch(err){}break}}else alert(data.message)})},$scope.editPacket=function(){$scope.currentPacketId=this.packet.id,$scope.packetCode=this.packet.packetCode,$scope.weightInGrams=this.packet.weightInGrams,$scope.markedPrice=this.packet.markedPrice,$scope.packetBtnText="SAVE",_lbFns.showViewForm()},$scope.cancelEdit=function($event){$event.preventDefault(),$scope.currentPacketId=0,$scope.packetCode="",$scope.weightInGrams="",$scope.markedPrice="",$scope.packetBtnText="ADD"},$scope.assignShop=function(){$scope.currentPacketId=this.packet.id,$scope.currentshopId=this.packet.shopId;var modalInstance=$uibModal.open({templateUrl:"/resources/ng-templates/admin/inv/modals/assign-shop.html"+versionCtrl,controller:"ModalAssignShopInstanceCtrl",backdrop:"static",resolve:{shops:function(){return $scope.shops},shopId:function(){return $scope.currentshopId},itemId:function(){return $scope.currentPacketId}}});modalInstance.result.then(function(modalScope){for(var i=0;i<$scope.packets.length;i++)if($scope.packets[i].id==modalScope.itemId){$scope.packets[i].shopName=modalScope.shopSelected.shopName,$scope.packets[i].shopId=modalScope.shopSelected.id;break}$.post("/inventory/apps/updatepacket",{id:modalScope.itemId,sp:modalScope.shopSelected.id,mode:"assignshop",opsid:_luvbriteGlobalOpsId},function(data){data.success||alert(data.message)})},function(){$scope.currentPacketId=0})},$scope.getSalesDetails=function(){0!=this.packet.salesId&&($scope.currentSalesId=this.packet.salesId,$http.get("/inventory/apps/listdispatches?id="+$scope.currentSalesId).success(function(data){if(data.success){$scope.dispatches=data.result,$scope.dateFinished=$scope.dispatches[0].dateFinished,$scope.dateArrived=$scope.dispatches[0].dateArrived,$scope.clientName=$scope.dispatches[0].clientName,$scope.paymentMode=$scope.dispatches[0].paymentMode,$scope.additionalInfo=$scope.dispatches[0].additionalInfo;var modalInstance=$uibModal.open({templateUrl:"/resources/ng-templates/admin/inv/modals/sales-info.html"+versionCtrl,controller:"ModalSalesInfoCtrl",backdrop:"static",size:"lg",resolve:{modalScope:function(){return{salesId:$scope.currentSalesId,dateFinished:$scope.dateFinished,dateArrived:$scope.dateArrived,clientName:$scope.clientName,paymentMode:$scope.paymentMode,additionalInfo:$scope.additionalInfo,driverName:$scope.driverName,tip:$scope.dispatches[0].tip,splitAmount:$scope.dispatches[0].splitAmount,commissionPercent:$scope.dispatches[0].commissionPercent,distInMiles:$scope.dispatches[0].distInMiles,status:$scope.dispatches[0].status,source:"packet"}}}});modalInstance.result.then(function(){},function(){})}}))},$(".packets-section").on("mouseenter","tr.returned",function(){var $tr=$(this);$tr.removeClass("returned").after('<tr class="danger"><td colspan="'+$tr.find("td").size()+'"><strong class="marg-l2">This packet was returned. Reason - '+$tr.attr("title")+"<strong></td></tr>")}),$scope.pg={currentPage:1,endCount:0,itemsPerPage:0,startCount:0,totalItems:0},$scope.sortBy="",$scope.sdir="ASC",$scope.pageChanged=function(){$scope.reload()},$scope.sortCol=function(param,e){sortColFns($scope,param,e)},$scope.pd={},$scope.refreshPurchaseInfo=function(){0!=$scope.purchaseId&&$http.get("/inventory/apps/purchaseinfo?pid="+$scope.purchaseId).success(function(data){data.success&&($scope.pd=data.result)})},$scope.refreshPurchaseInfo(),$scope.showBulkForm=!1,$scope.bulkPrice=0,$scope.bulkWt=0,$scope.bulkUpdate=function(){0!=$scope.bulkPrice&&0!=$scope.bulkWt&&$.post("/inventory/apps/updatepacket",{p:$scope.bulkPrice,w:$scope.bulkWt,pi:$scope.purchaseId,mode:"bulkUpdate",opsid:_luvbriteGlobalOpsId},function(data){data.success?(alert("Bulk update Success"),$scope.reload()):alert(data.message)})},$scope.resetBuldAdd=function(){$scope.bulkAddCount=0,$scope.bulkAddPrice=0,$scope.bulkAddWt=0},$scope.resetBuldAdd(),$scope.bulkAdd=function(){$scope.bulkAddCount>0&&$scope.bulkAddPrice>0&&$scope.bulkAddWt>0&&$.post("/inventory/apps/bulkpacketadd",{p:$scope.bulkAddPrice,w:$scope.bulkAddWt,c:$scope.bulkAddCount,pi:$scope.purchaseId,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){$scope.reload(),$scope.resetBuldAdd();var bcArray=[],codes=data.packetCodes.split(",");if(codes&&codes.length){var pname=$scope.pd.productName;pname.length>20&&(pname=pname.substr(0,15)+"..."+pname.substr(pname.length-4,pname.length)),codes.forEach(function(x){bcArray.push(x+"~"+pname)}),$rootScope.addToBCQueue(bcArray)}}else alert(data.message)})},$scope.getLabel=function(){var bcArray=[];if(this.packet.packetCode){var pname=$scope.pd.productName;pname.length>20&&(pname=pname.substr(0,15)+"..."+pname.substr(pname.length-4,pname.length)),bcArray.push(this.packet.packetCode+"~"+pname),$rootScope.addToBCQueue(bcArray)}},$scope.packets=[],$scope.reload=function(){$scope.alertTxt="";var urlParams="?cpage="+$scope.pg.currentPage+"&sort="+$scope.sortBy+"&sdir="+$scope.sdir+"&p="+$scope.purchaseId+"&pc="+$scope.sku+"&"+$scope.itemSelected.value+"=true&sp="+$scope.shopSelected1.id;$http.get("/inventory/apps/listpackets"+urlParams).success(function(data){data.success&&($scope.packets=data.result,data.pg&&($scope.pg=data.pg),$scope.purchaseSpecific&&$scope.packets.length>0&&($scope.productName=$scope.packets[0].productName))})},$scope.reload())},addPplCtrlr=function($scope,$http,$filter,$rootScope,$compile){$rootScope.rootPage="People &amp; Shops",$scope.controlId=_luvbriteGlobalOpsId,$scope.controlId>100||($scope.operators=[],$scope.currentOperatorId=0,$scope.opsBtnText="ADD",$http.get("/inventory/apps/listops").success(function(data){data.success&&($scope.operators=data.result)}),$scope.addOperator=function(){if(0!=$scope.currentOperatorId){for(var i=0;i<$scope.operators.length;i++)if($scope.operators[i].id==$scope.currentOperatorId){$scope.operators[i].operatorName=$scope.operatorName,$scope.operators[i].userName=$scope.opsUserName;break}$.post("/inventory/apps/updateops",{id:$scope.currentOperatorId,on:$scope.operatorName,un:$scope.opsUserName,up:$scope.opsPassword,opsid:_luvbriteGlobalOpsId},function(data){data.success||alert(data.message)}),$scope.currentOperatorId=0,$scope.operatorName="",$scope.opsUserName="",$scope.opsPassword="",$scope.opsBtnText="ADD"}else $scope.operators.push({operatorName:$scope.operatorName,userName:$scope.opsUserName,dateAdded:$filter("date")(new Date,"MM/dd/yyyy hh:mm a")}),$.post("/inventory/apps/newops",{on:$scope.operatorName,un:$scope.opsUserName,up:$scope.opsPassword,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.operators.length;i++)if($scope.operators[i].operatorName==data.operator.operatorName){$scope.operators[i]=data.operator;try{$scope.$apply()}catch(err){}break}}else alert(data.message)}),$scope.operatorName="",$scope.opsUserName="",$scope.opsPassword=""},$scope.editOperator=function($event){$event.preventDefault(),$scope.operatorName=this.operator.operatorName,$scope.opsUserName=this.operator.userName,$scope.currentOperatorId=this.operator.id,$scope.opsBtnText="SAVE",_lbFns.showViewFormS($("#addOperator .view-edit-form"))},$scope.cancelOperatorEdit=function($event){$event.preventDefault(),$scope.currentOperatorId=0,$scope.operatorName="",$scope.opsUserName="",$scope.opsPassword="",$scope.opsBtnText="ADD"},$scope.boxes=[],$scope.currentBoxId=0,$scope.boxBtnText="ADD",$http.get("/inventory/apps/listboxes").success(function(data){data.success&&($scope.boxes=data.result)}),$scope.addBox=function(){if(0!=$scope.currentBoxId){for(var i=0;i<$scope.boxes.length;i++)if($scope.boxes[i].id==$scope.currentBoxId){$scope.boxes[i].boxName=$scope.boxName;break}$.post("/inventory/apps/updatebox",{id:$scope.currentBoxId,bn:$scope.boxName,opsid:_luvbriteGlobalOpsId},function(data){data.success||alert(data.message)}),$scope.currentBoxId=0,$scope.boxName="",$scope.boxBtnText="ADD"}else $scope.boxes.push({boxName:$scope.boxName}),$.post("/inventory/apps/newbox",{bn:$scope.boxName,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.boxes.length;i++)if($scope.boxes[i].boxName==data.box.boxName){$scope.boxes[i]=data.box;try{$scope.$apply()}catch(err){}break}}else alert(data.message)}),$scope.boxName=""},$scope.editBox=function($event){$event.preventDefault(),$scope.boxName=this.box.boxName,$scope.currentBoxId=this.box.id,$scope.boxBtnText="SAVE",_lbFns.showViewFormS($("#addBox .view-edit-form"))},$scope.cancelBoxEdit=function($event){$event.preventDefault(),$scope.currentBoxId=0,$scope.boxName="",$scope.boxBtnText="ADD"},$scope.shops=[],$scope.currentShopId=0,$scope.shopBtnText="ADD",$http.get("/inventory/apps/listshops").success(function(data){data.success&&($scope.shops=data.result)}),$scope.addShop=function(){if(0!=$scope.currentShopId){for(var i=0;i<$scope.shops.length;i++)if($scope.shops[i].id==$scope.currentShopId){$scope.shops[i].shopName=$scope.shopName;break}$.post("/inventory/apps/updateshop",{id:$scope.currentShopId,sn:$scope.shopName,opsid:_luvbriteGlobalOpsId},function(data){data.success||alert(data.message)}),$scope.currentShopId=0,$scope.shopName="",$scope.shopBtnText="ADD"}else $scope.shops.push({shopName:$scope.shopName}),$.post("/inventory/apps/newshop",{sn:$scope.shopName,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.shops.length;i++)if($scope.shops[i].shopName==data.shop.shopName){$scope.shops[i]=data.shop;try{$scope.$apply()}catch(err){}break}}else alert(data.message)}),$scope.shopName=""},$scope.editShop=function($event){$event.preventDefault(),$scope.shopName=this.shop.shopName,$scope.currentShopId=this.shop.id,$scope.shopBtnText="SAVE",_lbFns.showViewFormS($("#addShop .view-edit-form"))},$scope.cancelShopEdit=function($event){$event.preventDefault(),$scope.currentShopId=0,$scope.shopName="",$scope.shopBtnText="ADD"},$scope.drivers=[],$scope.currentDriverId=0,$scope.driverBtnText="ADD",$http.get("/inventory/apps/listdrivers").success(function(data){data.success&&($scope.drivers=data.result)}),$scope.addDriver=function(){if(0!=$scope.currentDriverId){for(var i=0;i<$scope.drivers.length;i++)if($scope.drivers[i].id==$scope.currentDriverId){$scope.drivers[i].driverName=$scope.driverName,$scope.drivers[i].userName=$scope.driverUserName,$scope.drivers[i].phoneNumber=$scope.phoneNumber;break}$.post("/inventory/apps/updatedriver",{id:$scope.currentDriverId,dn:$scope.driverName,un:$scope.driverUserName,up:$scope.driverPassword,dp:$scope.phoneNumber,opsid:_luvbriteGlobalOpsId},function(data){data.success||alert(data.message)}),$scope.currentDriverId=0,$scope.driverName="",$scope.driverUserName="",$scope.driverPassword="",$scope.phoneNumber="",$scope.driverBtnText="ADD"}else $scope.drivers.push({driverName:$scope.driverName,userName:$scope.driverUserName,dateAdded:$filter("date")(new Date,"MM/dd/yyyy hh:mm a")}),$.post("/inventory/apps/newdriver",{dn:$scope.driverName,un:$scope.driverUserName,dp:$scope.phoneNumber,up:$scope.driverPassword,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.drivers.length;i++)if($scope.drivers[i].driverName==data.driver.driverName){$scope.drivers[i]=data.driver;try{$scope.$apply()}catch(err){}break}}else alert(data.message)}),$scope.driverName="",$scope.driverUserName="",$scope.phoneNumber="",$scope.driverPassword=""},$scope.editDriver=function($event){$event.preventDefault(),$scope.driverName=this.driver.driverName,$scope.driverUserName=this.driver.userName,$scope.currentDriverId=this.driver.id,$scope.phoneNumber=this.driver.phoneNumber,$scope.driverBtnText="SAVE",_lbFns.showViewFormS($("#addDriver .view-edit-form"))},$scope.cancelDriverEdit=function($event){$event.preventDefault(),$scope.currentDriverId=0,$scope.driverName="",$scope.driverUserName="",$scope.driverPassword="",$scope.phoneNumber="",$scope.driverBtnText="ADD"},$scope.vendors=[],$scope.currentVendorId=0,$scope.vendorBtnText="ADD",$http.get("/inventory/apps/listvendors").success(function(data){data.success&&($scope.vendors=data.result)}),$scope.addVendor=function(){if(0!=$scope.currentVendorId){for(var i=0;i<$scope.vendors.length;i++)if($scope.vendors[i].id==$scope.currentVendorId){$scope.vendors[i].vendorName=$scope.vendorName,$scope.vendors[i].company=$scope.vendorCompany,$scope.vendors[i].address=$scope.vendorAddress,$scope.vendors[i].city=$scope.vendorCity,$scope.vendors[i].state=$scope.vendorState,$scope.vendors[i].zipcode=$scope.vendorZipcode,$scope.vendors[i].phone=$scope.vendorPhone,$scope.vendors[i].email=$scope.vendorEmail,$scope.vendors[i].website=$scope.vendorWebsite;break}$.post("/inventory/apps/updatevendor",{id:$scope.currentVendorId,vn:$scope.vendorName,vc:$scope.vendorCompany,va:$scope.vendorAddress,vy:$scope.vendorCity,vs:$scope.vendorState,vz:$scope.vendorZipcode,vp:$scope.vendorPhone,ve:$scope.vendorEmail,vw:$scope.vendorWebsite,opsid:_luvbriteGlobalOpsId},function(data){data.success||alert(data.message)}),$scope.currentVendorId=0,$scope.vendorName="",$scope.vendorCompany="",$scope.vendorAddress="",$scope.vendorCity="",$scope.vendorState="",$scope.vendorZipcode="",$scope.vendorPhone="",$scope.vendorEmail="",$scope.vendorWebsite="",$scope.vendorBtnText="ADD"}else $scope.vendors.push({vendorName:$scope.vendorName,company:$scope.vendorCompany,address:$scope.vendorAddress,city:$scope.vendorCity,state:$scope.vendorState,zipcode:$scope.vendorZipcode,phone:$scope.vendorPhone,email:$scope.vendorEmail,website:$scope.vendorWebsite,dateAdded:$filter("date")(new Date,"MM/dd/yyyy hh:mm a")}),$.post("/inventory/apps/newvendor",{vn:$scope.vendorName,vc:$scope.vendorCompany,va:$scope.vendorAddress,vy:$scope.vendorCity,vs:$scope.vendorState,vz:$scope.vendorZipcode,vp:$scope.vendorPhone,ve:$scope.vendorEmail,vw:$scope.vendorWebsite,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.vendors.length;i++)if($scope.vendors[i].vendorName==data.vendor.vendorName){$scope.vendors[i].dateAdded=data.vendor.dateAdded,$scope.vendors[i].id=data.vendor.id;try{$scope.$apply()}catch(err){}break}}else alert(data.message)}),$scope.vendorName="",$scope.vendorCompany="",$scope.vendorAddress="",$scope.vendorCity="",$scope.vendorState="",$scope.vendorZipcode="",$scope.vendorPhone="",$scope.vendorEmail="",$scope.vendorWebsite=""},$scope.editVendor=function($event){$event.preventDefault(),$scope.vendorName=this.vendor.vendorName,$scope.vendorCompany=this.vendor.company,$scope.vendorAddress=this.vendor.address,$scope.vendorCity=this.vendor.city,$scope.vendorState=this.vendor.state,$scope.vendorZipcode=this.vendor.zipcode,$scope.vendorPhone=this.vendor.phone,$scope.vendorEmail=this.vendor.email,$scope.vendorWebsite=this.vendor.website,$scope.currentVendorId=this.vendor.id,$scope.vendorBtnText="SAVE",_lbFns.showViewFormS($("#addVendor .view-edit-form"))},$scope.cancelVendorEdit=function($event){$event.preventDefault(),$scope.currentVendorId=0,$scope.vendorName="",$scope.vendorCompany="",$scope.vendorAddress="",$scope.vendorCity="",$scope.vendorState="",$scope.vendorZipcode="",$scope.vendorPhone="",$scope.vendorEmail="",$scope.vendorWebsite="",$scope.vendorBtnText="ADD"})},addProductsCtrlr=function($scope,$http,$rootScope,$filter){$rootScope.rootPage="Products",$scope.controlId=_luvbriteGlobalOpsId,$scope.productBtnText="ADD",$scope.currentProductId=0,$scope.categories=[],$scope.filterCategories=[],$scope.categoryFilterSelected={id:0,categoryName:"All"},$http.get("/inventory/apps/listcats").success(function(data){data.success&&($scope.categories=data.result,$scope.categorySelected=$scope.categories[0],$scope.filterCategories=$scope.categories.slice(),$scope.filterCategories.unshift({id:0,categoryName:"All"}),$scope.categoryFilterSelected=$scope.filterCategories[0])}),$scope.strains=[],$scope.filterStrains=[],$scope.strainFilterSelected={id:0,strainName:"All"},$http.get("/inventory/apps/liststrains").success(function(data){data.success&&($scope.strains=data.result,$scope.strainSelected=$scope.strains[0],$scope.filterStrains=$scope.strains.slice(),$scope.filterStrains.unshift({id:0,strainName:"All"}),$scope.strainFilterSelected=$scope.filterStrains[0])}),$scope.addProduct=function(){if(0!=$scope.currentProductId){for(var i=0;i<$scope.products.length;i++)if($scope.products[i].id==$scope.currentProductId){$scope.products[i].productName=$scope.productName,$scope.products[i].nickName=$scope.nickName,
$scope.products[i].categoryId=$scope.categorySelected.id,$scope.products[i].categoryName=$scope.categorySelected.categoryName,$scope.products[i].strainId=$scope.strainSelected.id,$scope.products[i].strainName=$scope.strainSelected.strainName;break}$.post("/inventory/apps/updateproduct",{id:$scope.currentProductId,pn:$scope.productName,nn:$scope.nickName,ci:$scope.categorySelected.id,si:$scope.strainSelected.id,opsid:_luvbriteGlobalOpsId},function(data){data.success||alert(data.message)}),$scope.currentProductId=0,$scope.productName="",$scope.nickName="",$scope.productBtnText="ADD"}else $scope.products.push({productName:$scope.productName,nickName:$scope.nickName,categoryName:$scope.categorySelected.categoryName,categoryId:$scope.categorySelected.id,strainName:$scope.strainSelected.strainName,strainId:$scope.strainSelected.id,formattedDateAdded:$filter("date")(new Date,"MM/dd/yyyy hh:mm a")}),$.post("/inventory/apps/newproduct",{pn:$scope.productName,nn:$scope.nickName,ci:$scope.categorySelected.id,si:$scope.strainSelected.id,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.products.length;i++)if($scope.products[i].productName==data.prod.productName){$scope.products[i].formattedDateAdded=data.prod.formattedDateAdded,$scope.products[i].id=data.prod.id;try{$scope.$apply()}catch(err){}break}}else alert(data.message)}),$scope.productName="",$scope.nickName=""},$scope.editProduct=function($event){$event.preventDefault(),$scope.productName=this.product.productName,$scope.nickName=this.product.nickName;for(var i=0;i<$scope.categories.length;i++)if($scope.categories[i].id==this.product.categoryId){$scope.categorySelected=$scope.categories[i];break}for(var i=0;i<$scope.strains.length;i++)if($scope.strains[i].id==this.product.strainId){$scope.strainSelected=$scope.strains[i];break}$scope.currentProductId=this.product.id,$scope.productBtnText="SAVE",_lbFns.showViewForm()},$scope.cancelEdit=function($event){$event.preventDefault(),$scope.currentProductId=0,$scope.productName="",$scope.nickName="",$scope.productBtnText="ADD"},$scope.pg={currentPage:1,endCount:0,itemsPerPage:15,startCount:0,totalItems:0},$scope.pageChanged=function(){$scope.reload()},$scope.productSearch="",$scope.products=[],$scope.reload=function(){var urlParams="?cpage="+$scope.pg.currentPage+"&s="+$scope.strainFilterSelected.id+"&c="+$scope.categoryFilterSelected.id+"&pn="+$scope.productSearch;$http.get("/inventory/apps/listprods"+urlParams).success(function(data){data.success&&($scope.products=data.result,data.pg&&($scope.pg=data.pg))})},$scope.reload()},addPurchaseCtrlr=function($scope,$http,$filter,$rootScope,$uibModal){$rootScope.rootPage="Purchases",$scope.controlId=_luvbriteGlobalOpsId,$scope.purchaseBtnText="ADD",$scope.currentPurchaseId=0;var dn=new Date;$scope.dateAdded=new Date(dn.getFullYear(),dn.getMonth(),dn.getDate()),$scope.sku="",$scope.products=[],$http.get("/inventory/apps/listallprods").success(function(data){data.success&&($scope.products=data.result,$scope.prodSelected=$scope.products[0])}),$scope.vendors=[],$scope.filterVendors=[],$scope.vendorFilterSelected={id:0,vendorName:"All"},$http.get("/inventory/apps/listvendors").success(function(data){data.success&&($scope.vendors=data.result,$scope.vendorSelected=$scope.vendors[0],$scope.filterVendors=$scope.vendors.slice(),$scope.filterVendors.unshift($scope.vendorFilterSelected))}),$scope.addPurchase=function(){if(0!=$scope.currentPurchaseId){for(var i=0;i<$scope.purchases.length;i++)if($scope.purchases[i].id==$scope.currentPurchaseId){$scope.purchases[i].quantity=$scope.quantity,$scope.purchases[i].weightInGrams=$scope.weightInGrams,$scope.purchases[i].unitPrice=$scope.unitPrice,$scope.purchases[i].growthCondition=$scope.growthCondition,$scope.purchases[i].operatorComments=$scope.operatorComments,$scope.purchases[i].productId=$scope.prodSelected.id,$scope.purchases[i].productName=$scope.prodSelected.productName,$scope.purchases[i].vendorId=$scope.vendorSelected.id,$scope.purchases[i].vendorName=$scope.vendorSelected.vendorName,$scope.purchases[i].dateAdded=$filter("date")($scope.dateAdded,"yyyy-MM-dd");break}$.post("/inventory/apps/updatepurchase",{id:$scope.currentPurchaseId,qty:$scope.quantity,wt:$scope.weightInGrams,price:$scope.unitPrice,gc:$scope.growthCondition,oc:$scope.operatorComments,date:$filter("date")($scope.dateAdded,"yyyy-MM-dd"),pi:$scope.prodSelected.id,vi:$scope.vendorSelected.id,opsid:_luvbriteGlobalOpsId},function(data){data.success||alert(data.message)}),$scope.currentPurchaseId=0,$scope.quantity="",$scope.weightInGrams=0,$scope.unitPrice="",$scope.growthCondition="",$scope.operatorComments="",dn=new Date,$scope.dateAdded=new Date(dn.getFullYear(),dn.getMonth(),dn.getDate()),$scope.purchaseBtnText="ADD"}else $scope.purchases.push({id:"999999",productId:$scope.prodSelected.id,productName:$scope.prodSelected.productName,vendorId:$scope.vendorSelected.id,vendorName:$scope.vendorSelected.vendorName,quantity:$scope.quantity,weightInGrams:$scope.weightInGrams,unitPrice:$scope.unitPrice,growthCondition:$scope.growthCondition,operatorComments:$scope.operatorComments,dateAdded:$filter("date")($scope.dateAdded,"yyyy-MM-dd")}),$.post("/inventory/apps/newpurchase",{qty:$scope.quantity,wt:$scope.weightInGrams,price:$scope.unitPrice,gc:$scope.growthCondition,oc:$scope.operatorComments,date:$filter("date")($scope.dateAdded,"yyyy-MM-dd"),pi:$scope.prodSelected.id,vi:$scope.vendorSelected.id,pn:$scope.prodSelected.productName,vn:$scope.vendorSelected.vendorName,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.purchases.length;i++)if("999999"==$scope.purchases[i].id){$scope.purchases[i].dateAdded=data.purchase.dateAdded,$scope.purchases[i].id=data.purchase.id;try{$scope.$apply()}catch(err){}break}}else alert(data.message)}),$scope.currentPurchaseId=0,$scope.quantity="",$scope.weightInGrams=0,$scope.unitPrice="",$scope.growthCondition="",$scope.operatorComments="",dn=new Date,$scope.dateAdded=new Date(dn.getFullYear(),dn.getMonth(),dn.getDate())},$scope.editPurchase=function($event){$event.preventDefault(),$scope.currentPurchaseId=this.purchase.id,$scope.quantity=this.purchase.quantity,$scope.weightInGrams=this.purchase.weightInGrams,$scope.unitPrice=this.purchase.unitPrice,$scope.growthCondition=this.purchase.growthCondition,$scope.operatorComments=this.purchase.operatorComments,dn=new Date(Date.parse(this.purchase.dateAdded)),$scope.dateAdded=new Date(dn.getFullYear(),dn.getMonth(),dn.getDate());for(var i=0;i<$scope.products.length;i++)if($scope.products[i].id==this.purchase.productId){$scope.prodSelected=$scope.products[i];break}for(var i=0;i<$scope.vendors.length;i++)if($scope.vendors[i].id==this.purchase.vendorId){$scope.vendorSelected=$scope.vendors[i];break}$scope.purchaseBtnText="SAVE",_lbFns.showViewForm()},$scope.cancelEdit=function($event){$event.preventDefault(),$scope.currentPurchaseId=0,$scope.quantity="",$scope.weightInGrams=0,$scope.unitPrice="",$scope.growthCondition="",$scope.operatorComments="",dn=new Date,$scope.dateAdded=new Date(dn.getFullYear(),dn.getMonth(),dn.getDate()),$scope.purchaseBtnText="ADD"},$scope.addAdjustment=function(){var modalInstance=$uibModal.open({templateUrl:"/resources/ng-templates/admin/inv/modals/inv-adjustment.html"+versionCtrl,controller:"ModalInvAdjCtrl",backdrop:"static",resolve:{modalScope:function(){return{products:$scope.products,controlId:$scope.controlId}}}});modalInstance.result.then(function(){$scope.reload()},function(){})},$scope.pg={currentPage:1,endCount:0,itemsPerPage:0,startCount:0,totalItems:0},$scope.productSearch="",$scope.sortBy="",$scope.sdir="ASC",$scope.pageChanged=function(){$scope.reload()},$scope.sortCol=function(param,e){sortColFns($scope,param,e)},$scope.purchases=[],$scope.reload=function(){var urlParams="?cpage="+$scope.pg.currentPage+"&sort="+$scope.sortBy+"&sdir="+$scope.sdir+"&v="+$scope.vendorFilterSelected.id+"&pc="+$scope.sku+"&pn="+$scope.productSearch;$http.get("/inventory/apps/listpurchases"+urlParams).success(function(data){data.success&&($scope.purchases=data.result,data.pg&&($scope.pg=data.pg))})},$scope.reload()},returnsCtrlr=function($scope,$http,$rootScope){$rootScope.rootPage="Returns",$scope.controlId=_luvbriteGlobalOpsId,$scope.controlId>100||($scope.packetCode="",$scope.reason="",$scope.reasons=["Customer didn't like the item"],$scope.btnTxt="ADD",$http.get("/inventory/apps/listreasons").success(function(data){data.success&&data.result.length>0&&($scope.reasons=data.result)}),$scope.removeReturn=function(){var returnId=this.return.id;void 0!==returnId&&0!=returnId?$http.get("apps/removereturn",{params:{id:returnId,opsid:_luvbriteGlobalOpsId}}).success(function(res){if(res.success){for(var i=0;i<$scope.returns.length;i++)if($scope.returns[i].id==returnId){$scope.returns.splice(i,1);break}}else alert(res.message)}).error(function(){alert("There was some error removing the return.")}):alert("Error deleting the return. Please contact G.")},$scope.addReturn=function(){for(var proceed=!0,i=0;i<$scope.returns.length;i++)if($scope.returns[i].packetCode==$scope.packetCode){alert("This packet has been already scanned"),proceed=!1;break}proceed&&($scope.returns.push({packetCode:$scope.packetCode,reason:$scope.reason,productName:""}),$scope.btnTxt="Adding...",$.post("/inventory/apps/newreturn",{pc:$scope.packetCode,reason:$scope.reason,opsid:_luvbriteGlobalOpsId},function(data){if($scope.btnTxt="ADD",data.success){$scope.packetCode="",$("#packetCode").focus();for(var i=0;i<$scope.returns.length;i++)if($scope.returns[i].packetCode==data.returns.packetCode){$scope.returns[i].productName=data.returns.productName;break}}else alert(data.message);try{$scope.$apply()}catch(err){}}))},$scope.pg={currentPage:1,endCount:0,itemsPerPage:0,startCount:0,totalItems:0},$scope.sortBy="",$scope.sdir="ASC",$scope.pageChanged=function(){$scope.reload()},$scope.returns=[],$scope.reload=function(){var urlParams="?cpage="+$scope.pg.currentPage;$http.get("/inventory/apps/listreturns"+urlParams).success(function(data){data.success&&($scope.returns=data.result,data.pg&&($scope.pg=data.pg))})},$scope.reload())},ModalSalesInfoCtrlr=function($scope,$uibModalInstance,modalScope,$http,$filter){$scope.controlId=_lbGlobalCDNPath,$scope.ms=modalScope,$scope.totals=0,$scope.packets=[],$scope.locked=!1,$scope.getTotals=function(){$scope.totals=0;for(var i=0;i<$scope.packets.length;i++)$scope.totals+=$scope.packets[i].sellingPrice;$scope.totals+=parseFloat($scope.ms.tip)},$scope.cancel=function(){$uibModalInstance.dismiss($scope.ms)},$scope.ms.updated=!1,$scope.tipEdit=!1,$scope.newTip="",$scope.editTip=function(){$scope.tipEdit=!0,$scope.newTip=$scope.ms.tip},$scope.saveTip=function(){return $scope.locked?void alert("This sale has been closed. No further edits possible."):($scope.ms.tip=$scope.newTip,void $http.get("/inventory/apps/updatedispatch",{params:{mode:"tipupdate",t:$scope.ms.tip,id:$scope.ms.salesId,opsid:_luvbriteGlobalOpsId}}).success(function(data){data.success?($scope.tipEdit=!1,$scope.ms.updated=!0,$scope.getTotals()):alert(data.message)}))},$scope.newSplit="",$scope.saveSplitAmt=function(){return $scope.locked?void alert("This sale has been closed. No further edits possible."):($scope.ms.splitAmount=$scope.newSplit,void $http.get("/inventory/apps/updatedispatch",{params:{mode:"splitupdate",sa:$scope.ms.splitAmount,id:$scope.ms.salesId,opsid:_luvbriteGlobalOpsId}}).success(function(data){data.success?($scope.splitEdit=!1,$scope.ms.updated=!0):alert(data.message)}))},$scope.dateEdit=!1,$scope.newFinishDate="",$scope.editDate=function(){$scope.dateEdit=!0;var dn=new Date(Date.parse($scope.ms.dateFinished));$scope.newFinishDate=new Date(dn.getFullYear(),dn.getMonth(),dn.getDate(),dn.getHours(),dn.getMinutes())},$scope.saveDate=function(){return $scope.locked?void alert("This sale has been closed. No further edits possible."):($scope.ms.dateFinished=$filter("date")($scope.newFinishDate,"MM/dd/yyyy hh:mm a"),void $http.get("/inventory/apps/updatedispatch",{params:{mode:"dateupdate",d:$scope.ms.dateFinished,id:$scope.ms.salesId,opsid:_luvbriteGlobalOpsId}}).success(function(data){data.success?($scope.dateEdit=!1,$scope.ms.updated=!0):alert(data.message)}))},$scope.pmtModeEdit=!1,$scope.pmtModes=_globalPmtModes,$scope.pmtModeSelected=$scope.pmtModes[0],$scope.editPmtMode=function(){$scope.pmtModes.forEach(function(x){x.value==$scope.ms.paymentMode&&($scope.pmtModeSelected=x)}),$scope.pmtModeEdit=!0},$scope.savePmtMode=function(){return $scope.locked?void alert("This sale has been closed. No further edits possible."):void $http.get("/inventory/apps/updatedispatch",{params:{mode:"pmtmodeupdate",p:$scope.pmtModeSelected.label,id:$scope.ms.salesId,opsid:_luvbriteGlobalOpsId}}).success(function(data){data.success?($scope.pmtModeEdit=!1,$scope.ms.updated=!0,$scope.ms.paymentMode=$scope.pmtModeSelected.label):alert(data.message)})},$scope.distRecal=function(){return $scope.locked?void alert("This sale has been closed. No further edits possible."):void $http.get("/inventory/apps/updatedispatch",{params:{mode:"recal_dist",id:$scope.ms.salesId,opsid:_luvbriteGlobalOpsId}}).then(function(resp){var data=resp.data;data.success?$scope.ms.distInMiles=parseFloat(data.message):alert(data.message)})},$scope.adjustment=null,$scope.adjustmentInProcess=!1,$scope.addAdjustment=function(){$scope.adjustmentInProcess||($scope.adjustment={code:"Adjustment",amount:0,reason:""},$(".adjustmentReason").focus(),$scope.adjustmentInProcess=!0)},$scope.saveAdjustment=function(){return $scope.locked?void alert("This sale has been closed. No further edits possible."):(_lbFns.showBusy(),void $http.get("/inventory/apps/newadjustment",{params:{a:$scope.adjustment.amount,r:$scope.adjustment.reason,id:$scope.ms.salesId,d:$scope.ms.dateFinished,opsid:_luvbriteGlobalOpsId}}).success(function(data){$("div.lboverlay").remove(),data.success?($scope.adjustmentInProcess=!1,$scope.adjustment=null,$scope.loadSaleItems()):alert(data.message)}).error(function(){$("div.lboverlay").remove()}))},$scope.addPromo=function(code,val){return $scope.locked?void alert("This sale has been closed. No further edits possible."):(_lbFns.showBusy(),void $http.get("/inventory/apps/newadjustment",{params:{a:val,r:code,id:$scope.ms.salesId,d:$scope.ms.dateFinished,opsid:_luvbriteGlobalOpsId}}).success(function(data){$("div.lboverlay").remove(),data.success?($scope.adjustmentInProcess=!1,$scope.adjustment=null,$scope.loadSaleItems()):alert(data.message)}).error(function(){$("div.lboverlay").remove()}))},$scope.addCrtsyPromo=function(){$scope.adjustment={code:"Adjustment",amount:-10,reason:"PROMOCRTSY"},$(".adjustmentReason").focus(),$scope.adjustmentInProcess=!0},$scope.removeItem=function(){return $scope.locked?void alert("This sale has been closed. No further edits possible."):(_lbFns.showBusy(),void $http.get("/inventory/apps/updatepacket",{params:{mode:"remove",pc:this.packet.packetCode,id:this.packet.id,opsid:_luvbriteGlobalOpsId}}).then(function(resp){$("div.lboverlay").remove();var data=resp.data;if(data.success){for(var i=0;i<$scope.packets.length;i++)if($scope.packets[i].id==data.packet.id){$scope.packets.splice(i,1),$scope.getTotals();break}}else alert(data.message)},function(){$("div.lboverlay").remove()}))},$scope.prevSalesId=0,$scope.nextSalesId=0;var prevNextLogic=function(){if($scope.prevSalesId=0,$scope.nextSalesId=0,$scope.ms.nextPrevDispatches){var length=$scope.ms.nextPrevDispatches.length,lastIndx=length?length-1:0;if(lastIndx)for(var i=0;i<length;i++)if($scope.ms.nextPrevDispatches[i]==$scope.ms.salesId){0!=i&&($scope.prevSalesId=$scope.ms.nextPrevDispatches[i-1]),i!=lastIndx&&($scope.nextSalesId=$scope.ms.nextPrevDispatches[i+1]);break}}};prevNextLogic(),$scope.getNextSales=function(){$scope.nextSalesId&&getNewSalesInfo($scope.nextSalesId)},$scope.getPrevSales=function(){$scope.prevSalesId&&getNewSalesInfo($scope.prevSalesId)};var getNewSalesInfo=function(salesId){$scope.ms.salesId=0,$scope.packets=[],$http.get("/inventory/apps/listdispatches?id="+salesId).then(function(resp){var data=resp.data;if(data.success){var dispatches=data.result;$scope.ms.salesId=salesId,$scope.ms.dateFinished=dispatches[0].dateFinished,$scope.ms.dateArrived=dispatches[0].dateArrived,$scope.ms.clientName=dispatches[0].clientName,$scope.ms.paymentMode=dispatches[0].paymentMode,$scope.ms.additionalInfo=dispatches[0].additionalInfo,$scope.ms.driverName=dispatches[0].driverName,$scope.ms.tip=dispatches[0].tip,$scope.ms.splitAmount=dispatches[0].splitAmount,$scope.ms.commissionPercent=dispatches[0].commissionPercent,$scope.ms.distInMiles=dispatches[0].distInMiles,$scope.ms.status=dispatches[0].status,$scope.loadSaleItems(),prevNextLogic(),checkStatus()}})},checkStatus=function(){$scope.locked=!1,$scope.ms.status&&"locked"==$scope.ms.status&&($scope.locked=!0)};checkStatus(),$scope.loadSaleItems=function(){$http.get("/inventory/apps/listpackets?s="+$scope.ms.salesId).success(function(data){data.success?($scope.packets=data.result,$scope.getTotals()):alert(data.message)})},$scope.loadSaleItems()},shopInvCtrlr=function($scope,$http,$rootScope,$filter){$rootScope.rootPage="Shop Inventory",$scope.controlId=_luvbriteGlobalOpsId,$scope.sis=[],$scope.grantTotal=0,$scope.sortType="productId",$scope.sortReverse=!1,$scope.productSearch="",$scope.dateFilter=new Date,$scope.loading=!0,$scope.loadData=function(){$http.get("/inventory/apps/listshopinv?d="+$filter("date")($scope.dateFilter,"MM/dd/yyyy")+"&sp="+$scope.shopSelected.id).success(function(data){data.success&&($scope.sis=data.result,$scope.getTotal(),$scope.loading=!1)})},$scope.getTotal=function(){$scope.grantTotal=0;for(var i=0;i<$scope.sis.length;i++)$scope.grantTotal+=$scope.sis[i].inventoryCost},$scope.setTotal=function(){var total=0;$(".invcost").each(function(){total+=$(this).data("invcost")}),$scope.grantTotal=total},$scope.reload=function(){$scope.loading=!0,$scope.sis=[],$scope.loadData()},$scope.getLowInventoryCSV=function(){window.location="/inventory/apps/lowinventorycsv?iacsv=1"},$scope.shopSelected={id:"-1",shopName:"All Shops"},$scope.shops=[],$http.get("/inventory/apps/listshops").success(function(data){data.success&&($scope.shops=data.result,$scope.shops.unshift($scope.shopSelected),$scope.loadData())})},statsCtrlr=function($scope,$http,$filter,$uibModal,$rootScope){if($rootScope.rootPage="Statistics",$scope.controlId=_luvbriteGlobalOpsId,$scope.accessGranted=!1,!($scope.controlId>100)){$scope.accessGranted=!0,$scope.stats=[],$scope.sTotalAmount=0,$scope.sortField="amount",$scope.sortReverse=!0,$http.get("/inventory/apps/getbasestat").success(function(data){data.success&&($scope.stats=data.result)}),$scope.driverSelected={driverName:"All Drivers",id:0},$http.get("/inventory/apps/listdrivers").success(function(data){data.success&&($scope.drivers=data.result,$scope.drivers.unshift($scope.driverSelected))}),$scope.startDate="",$scope.endDate="",$scope.saveDate=function(key){"stsDate"==key?sessionStorage.setItem(key,$scope.startDate.getTime()):sessionStorage.setItem(key,$scope.endDate.getTime())},$scope.setDates=function(){var startDate=sessionStorage.getItem("stsDate"),endDate=sessionStorage.getItem("steDate");if(startDate)$scope.startDate=new Date(parseInt(startDate));else{var dn=new Date;$scope.startDate=new Date(dn.getFullYear(),dn.getMonth(),dn.getDate())}endDate&&($scope.endDate=new Date(parseInt(endDate)))},$scope.setDates(),$scope.das=[],$scope.dStats=[],$scope.dasTipTotal=0,$scope.dasCommTotal=0,$scope.getDriverStat=function(){$http.get("/inventory/apps/getstat",{params:{sd:$filter("date")($scope.startDate,"MM/dd/yyyy"),ed:$filter("date")($scope.endDate,"MM/dd/yyyy"),d:$scope.driverSelected.id}}).success(function(data){$scope.alertTxt="",$scope.das=[],$scope.dStats=[],data.success?0==$scope.driverSelected.id?($scope.das=data.result,$scope.getTotal(),0==$scope.das.length&&($scope.alertTxt="No data found")):($scope.dStats=data.result,0==$scope.dStats.length&&($scope.alertTxt="No data found")):alert(data.message)})},$scope.getTotal=function(){$scope.sTotalAmount=0,$scope.dasTipTotal=0,$scope.dasCommTotal=0;for(var i=0;i<$scope.das.length;i++)$scope.sTotalAmount+=$scope.das[i].amount,$scope.dasCommTotal+=$scope.das[i].commission,$scope.dasTipTotal+=$scope.das[i].tip},$scope.orStats=[],$scope.getOrderStat=function(){$http.get("/inventory/apps/getorderstat",{params:{sd:$filter("date")($scope.startDate,"MM/dd/yyyy"),ed:$filter("date")($scope.endDate,"MM/dd/yyyy")}}).success(function(data){$scope.alertTxt="",data.success?($scope.orStats=data.result,0==$scope.orStats.length&&($scope.alertTxt="No data found"),$scope.orderStatSummary()):alert(data.message)})},$scope.orderStatSummary=function(){for(var i=0;i<$scope.orStats.length;i++){for(var originalTotal=0,tipTotal=0,ostats=$scope.orStats[i].ostat,j=0;j<ostats.length;j++)originalTotal+=ostats[j].originalTotal,tipTotal+=ostats[j].tip;$scope.orStats[i].originalAmountTotal=originalTotal,$scope.orStats[i].tipTotal=tipTotal}},$scope.pStats=[],$scope.getProdStat=function(){$http.get("/inventory/apps/getprodstat",{params:{sd:$filter("date")($scope.startDate,"MM/dd/yyyy"),ed:$filter("date")($scope.endDate,"MM/dd/yyyy")}}).success(function(data){$scope.alertTxt="",data.success?($scope.pStats=data.result,0==$scope.pStats.length?$scope.alertTxt="No data found":$scope.pStats.forEach(function(e){e.mode=parseInt(e.mode)})):alert(data.message)})},$scope.cStats=[],$scope.getCustStat=function(){$http.get("/inventory/apps/getcuststat",{params:{sd:$filter("date")($scope.startDate,"MM/dd/yyyy"),ed:$filter("date")($scope.endDate,"MM/dd/yyyy")}}).success(function(data){$scope.alertTxt="",data.success?($scope.cStats=data.result,0==$scope.cStats.length&&($scope.alertTxt="No data found")):alert(data.message)})},$scope.psStats=[],$scope.getProfitSalesStat=function(){$http.get("/inventory/apps/getprofitsales",{params:{sd:$filter("date")($scope.startDate,"MM/dd/yyyy"),ed:$filter("date")($scope.endDate,"MM/dd/yyyy")}}).success(function(data){$scope.alertTxt="",data.success?($scope.psStats=data.salesprofit,$scope.getPsStatTotal(),0==$scope.psStats.length&&($scope.alertTxt="No data found")):alert(data.message)})},$scope.activeTab=0,$scope.tabChange=function(){0==$scope.das.length&&0==$scope.dStats.length&&$scope.getDriverStat(),0==$scope.orStats.length&&$scope.getOrderStat(),0==$scope.pStats.length&&$scope.getProdStat(),0==$scope.cStats.length&&$scope.getCustStat(),0==$scope.psStats.length&&$scope.getProfitSalesStat()},$scope.getStat=function(){$scope.getDriverStat(),$scope.getOrderStat(),$scope.getProdStat(),$scope.getCustStat(),$scope.getProfitSalesStat(),6==$scope.activeTab&&$scope.loadHeatMap()},$scope.psStatTotal=0,$scope.psStatSTotal=0,$scope.psStatPTotal=0,$scope.getPsStatTotal=function(){$scope.psStatTotal=0,$scope.psStatSTotal=0,$scope.psStatPTotal=0;for(var i=0;i<$scope.psStats.length;i++)$scope.psStatTotal+=$scope.psStats[i].total,$scope.psStatSTotal+=$scope.psStats[i].sellingTotal,$scope.psStatPTotal+=$scope.psStats[i].purchaseTotal},$scope.closeOpenBatch=function(mode){var currentOstat=this.orStat.ostat;if(currentOstat){var nextPrevDispatches="";currentOstat.forEach(function(x){nextPrevDispatches+=","+x.dispatchId}),","==nextPrevDispatches.substr(0,1)&&(nextPrevDispatches=nextPrevDispatches.substr(1)),$http.get("/inventory/apps/updatedispatch",{params:{mode:mode,sids:nextPrevDispatches,id:10,opsid:_luvbriteGlobalOpsId}}).then(function(resp){var data=resp.data;if(data.success){var status="open";"closesales"==mode&&(status="locked"),currentOstat.forEach(function(x){x.status=status})}else alert(data.message)})}},$scope.getSalesDetails=function(){var currentSalesId=this.ostat?this.ostat.dispatchId:this.orStat.ostat[0].dispatchId;if(currentSalesId){var nextPrevDispatches=[];$scope.orStats.forEach(function(y){y.ostat.forEach(function(x){nextPrevDispatches.push(x.dispatchId)})}),$http.get("/inventory/apps/listdispatches?id="+currentSalesId).success(function(data){if(data.success){var dispatches=data.result[0],modalInstance=$uibModal.open({templateUrl:"/resources/ng-templates/admin/inv/modals/sales-info.html"+versionCtrl,controller:"ModalSalesInfoCtrl",backdrop:"static",size:"lg",resolve:{modalScope:function(){return{salesId:currentSalesId,dateFinished:dispatches.dateFinished,dateArrived:dispatches.dateArrived,clientName:dispatches.clientName,paymentMode:dispatches.paymentMode,additionalInfo:dispatches.additionalInfo,driverName:dispatches.driverName,tip:dispatches.tip,splitAmount:dispatches.splitAmount,commissionPercent:dispatches.commissionPercent,source:"report",nextPrevDispatches:nextPrevDispatches,distInMiles:dispatches.distInMiles,status:dispatches.status}}}});modalInstance.result.then(function(){},function(){})}})}},$scope.chartLoaded=!1,$scope.showChart=!1,$scope.toggleChartView=function(){$scope.showChart=!$scope.showChart,$scope.chartLoaded||$scope.loadChart()},$scope.loadChart=function(){$http.get("/inventory/apps/getdailysales",{params:{sd:$filter("date")($scope.startDate,"MM/dd/yyyy"),ed:$filter("date")($scope.endDate,"MM/dd/yyyy")}}).success(function(data){$scope.chartLoaded=!0;var jsonData=data.dt;jsonData.rows.forEach(function(e){var dateFormat=e.c[0].v;if(10==dateFormat.length){var splits=dateFormat.split("/");e.c[0].v=new Date(splits[0],parseInt(splits[1])-1,splits[2])}else e.c[0].v=null});var data=new google.visualization.DataTable(jsonData),dashboard=new google.visualization.Dashboard(document.getElementById("chartRangeFilter_dashboard_div")),controlSales=new google.visualization.ControlWrapper({controlType:"ChartRangeFilter",containerId:"div_sales_control",options:{filterColumnIndex:0,ui:{chartType:"LineChart",chartOptions:{chartArea:{width:"80%",height:"100%"},colors:["grey"],hAxis:{baselineColor:"none"}},minRangeSize:6048e5}},state:{range:{start:new Date((new Date).getTime()-1296e6),end:new Date}}}),chartSales=new google.visualization.ChartWrapper({chartType:"AreaChart",chartArea:{height:"80%",width:"90%"},containerId:"div_sales_chart",options:{vAxis:{title:"Amount in $"},hAxis:{title:"Date"},title:"Daily Sales",colors:["green"],legend:{position:"none"}},view:{columns:[0,1]}}),chartCount=new google.visualization.ChartWrapper({chartType:"AreaChart",chartArea:{height:"80%",width:"90%"},containerId:"div_count_chart",options:{vAxis:{title:"Count"},hAxis:{title:"Date"},title:"Order Count",legend:{position:"none"}},view:{columns:[0,2]}});dashboard.bind(controlSales,[chartSales,chartCount]),dashboard.draw(data);var mData=new google.visualization.DataTable(jsonData),mSalesView=google.visualization.data.group(mData,[{column:0,modifier:function(value){return new Date(value.getFullYear(),value.getMonth())},type:"date"}],[{column:1,aggregation:google.visualization.data.sum,type:"number"}]),mCountView=google.visualization.data.group(mData,[{column:0,modifier:function(value){return new Date(value.getFullYear(),value.getMonth())},type:"date"}],[{column:2,aggregation:google.visualization.data.sum,type:"number"}]),monthlySales=new google.visualization.ColumnChart(document.getElementById("div_msales_chart")),mOptions1={vAxis:{title:"Amount in $"},hAxis:{title:"Date"},title:"Monthly Sales",colors:["green"],legend:{position:"none"}};monthlySales.draw(mSalesView,mOptions1);var monthlyCounts=new google.visualization.ColumnChart(document.getElementById("div_mcount_chart")),mOptions2={vAxis:{title:"Count"},hAxis:{title:"Date"},title:"Monthly Order Count",legend:{position:"none"}};monthlyCounts.draw(mCountView,mOptions2)})};try{google.charts.load("current",{packages:["corechart","controls"]})}catch(e){}$scope.hm={},$scope.hm.avgDistance=0;var map1,map2,heatmap,mapPoints=[new google.maps.LatLng(37.782551,-122.445368)];$scope.loadHeatMap=function(){$scope.alertTxt="",$http.get("/inventory/apps/plotsalesmap",{params:{sd:$filter("date")($scope.startDate,"MM/dd/yyyy"),ed:$filter("date")($scope.endDate,"MM/dd/yyyy")}}).then(function(resp){var data=resp.data;if(data.success){mapPoints=[];var totalDistance=0;if(data.result&&data.result.length>0){data.result.forEach(function(x){totalDistance+=x.distInMiles,mapPoints.push(new google.maps.LatLng(x.lat,x.lng))}),$scope.hm.avgDistance=totalDistance/data.result.length;var myLatLng={lat:34.034745,lng:-118.45228};map1=new google.maps.Map(document.getElementById("heatMapWrapper"),{zoom:11,center:myLatLng}),heatmap=new google.maps.visualization.HeatmapLayer({data:mapPoints,map:map1}),map2=new google.maps.Map(document.getElementById("markerMapWrapper"),{zoom:11,center:myLatLng}),data.result.forEach(function(x){new google.maps.Marker({position:{lat:x.lat,lng:x.lng},map:map2,icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:"#ff6666",fillOpacity:1,scale:4,strokeWeight:2}})})}else $scope.alertTxt="No data found"}})}}},stockTakeCtrlr=function($scope,$http,$rootScope,$timeout){$rootScope.rootPage="Stock",$scope.controlId=_luvbriteGlobalOpsId,$scope.controlId>100||($scope.productCode="",$scope.productSelected={},$scope.searchOn=!1,$scope.stockInfoFound=!0,$scope.difference=0,$scope.adjRsn="",$scope.successMsg="",$scope.pos=[],$http.get("/inventory/apps/listallprods").success(function(data){data.success&&data.result.length>0&&($scope.pos=data.result,$timeout(function(){$("#productCode").focus()}))}),$scope.getProducts=function(){""!=$scope.productCode&&($scope.searchOn=!0)},$scope.pinfo={},$scope.getStock=function(){return $scope.searchOn=!1,""!=$scope.productCode&&$scope.productCode==parseInt($scope.productCode)&&($scope.productSelected.id=$scope.productCode),$scope.productSelected&&$scope.productSelected.id?void $http.get("/inventory/apps/listshopinv",{params:{pid:$scope.productSelected.id}}).success(function(res){res.success?res.result.length>0?($scope.pinfo=res.result[0],$scope.pinfo.product=$scope.productSelected,$scope.stockInfoFound=!0,$scope.productSelected={},$scope.productCode="",$timeout(function(){$(".actuals").focus()})):$scope.stockInfoFound=!1:alert(res.message)}).error(function(){alert("There was some error getting the stock info.")}):($scope.stockInfoFound=!1,void($scope.productSelected={}))},$scope.selectThisProduct=function(){$scope.searchOn=!1,$scope.productSelected=$.extend(!0,{},this.po),$scope.productCode=$scope.productSelected.productName,$scope.pinfo={},$scope.getStock()},$scope.calculateDiff=function(){$scope.difference=parseFloat($scope.pinfo.remainingTotal)-parseFloat($scope.pinfo.actual),isNaN($scope.difference)&&($scope.difference=0),0!=$scope.difference&&$scope.getPrice()},$scope.price="",$scope.weight="",$scope.prices=[],$scope.weights=[],$scope.getPrice=function(){$http.get("/inventory/apps/listprodpriceweight",{params:{pid:$scope.pinfo.product.id}}).success(function(data){data.success&&($scope.price="",$scope.weight="",$scope.prices=data.prices,1==$scope.prices.length&&($scope.price=$scope.prices[0]),1!=$scope.pinfo.product.categoryId&&($scope.weights=data.weights,1==$scope.weights.length&&($scope.weight=$scope.weights[0])))})},$scope.saveAdj=function(){var adjType="add";$scope.difference>0&&(adjType="red");var qty=1,wt=1,cid=0;$scope.pinfo.flower?(wt=$scope.difference,cid=1):(wt=$scope.weight,qty=$scope.difference);var req={method:"POST",url:"/inventory/apps/newinvadj",params:{pid:$scope.pinfo.product.id,rsn:$scope.adjRsn,type:adjType,wt:wt,qty:qty,price:$scope.price,cid:cid,opsid:_luvbriteGlobalOpsId}};$http(req).then(function(response){var data=response.data;data.success?($scope.successMsg="Adjusted Added. Stock Updated.",$scope.difference=0,$scope.productSelected=$scope.pinfo.product,$scope.pinfo={},$scope.getStock()):alert(data.message)},function(){alert("There was some error processing your request.")})})},addStrainsCtrlr=function($scope,$http,$filter,$rootScope){$rootScope.rootPage="Strains",$scope.controlId=_luvbriteGlobalOpsId,$scope.currentStrainId=0,$scope.btnText="ADD",$scope.strains=[],$http.get("/inventory/apps/liststrains").success(function(data){data.success&&($scope.strains=data.result)}),$scope.addStrain=function(){if(0!=$scope.currentStrainId){for(var i=0;i<$scope.strains.length;i++)if($scope.strains[i].id==$scope.currentStrainId){
$scope.strains[i].strainName=$scope.strainName;break}$.post("/inventory/apps/updatestrain",{id:$scope.currentStrainId,sn:$scope.strainName,opsid:_luvbriteGlobalOpsId},function(data){data.success||alert(data.message)}),$scope.currentStrainId=0,$scope.strainName="",$scope.btnText="ADD"}else $scope.strains.push({strainName:$scope.strainName,formattedDateAdded:$filter("date")(new Date,"MM/dd/yyyy hh:mm a")}),$.post("/inventory/apps/newstrain",{sn:$scope.strainName,opsid:_luvbriteGlobalOpsId},function(data){if(data.success){for(var i=0;i<$scope.strains.length;i++)if($scope.strains[i].strainName==data.strain.strainName){$scope.strains[i]=data.strain;try{$scope.$apply()}catch(err){}break}}else alert(data.message)}),$scope.strainName=""},$scope.editStrain=function($event){$event.preventDefault(),$scope.strainName=this.strain.strainName,$scope.currentStrainId=this.strain.id,$scope.btnText="SAVE",_lbFns.showViewForm()},$scope.cancelEdit=function($event){$event.preventDefault(),$scope.currentStrainId=0,$scope.strainName="",$scope.btnText="ADD"}},versionCtrl="?v"+Math.random(),_globalPmtModes=[{label:"Cash",value:"Cash"},{label:"Credit Card",value:"Credit Card"},{label:"Paypal",value:"Paypal"},{label:"Split",value:"Split"}],sortColFns=function($scope,param,e){$scope.sortBy=param;var $currentTarget=$(e.currentTarget);$currentTarget.hasClass("sdir-asc")?($scope.sdir="DESC",$(".sdir-asc,.sdir-desc").removeClass("sdir-desc sdir-asc"),$currentTarget.addClass("sdir-desc")):($scope.sdir="ASC",$(".sdir-asc,.sdir-desc").removeClass("sdir-desc sdir-asc"),$currentTarget.addClass("sdir-asc")),$scope.reload()},app=angular.module("invApp",["ngRoute","ngSanitize","ui.bootstrap"]),globalResolve={currentUser:function($q,$rootScope){var deferred=$q.defer();return $rootScope.globals&&$rootScope.globals.currentUser&&$rootScope.globals.currentUser.ctrlid&&0!=$rootScope.globals.currentUser.ctrlid||($rootScope.globals={currentUser:{ctrlid:_luvbriteGlobalOpsId}}),deferred.resolve($rootScope.globals.currentUser),deferred.promise}},defaultCtrlr=function(){};app.config(["$routeProvider",inventoryRouter]).config(["$httpProvider",appConfigs]).run(["$http","$rootScope","$interval",appRunFns]).run(function($rootScope,$location,$http){$rootScope.$on("$locationChangeStart",function(event,next,current){if(current.indexOf("inv-alert-settings")>-1&&$(".inv-save-alert>.glyphicon:visible").size()>0){var sure=confirm("You have unsaved changes. Leave the page?");if(!sure)return void event.preventDefault()}$("ul.navbar-nav a").removeClass("active").each(function(){var $this=$(this),href=$this.attr("href");if(href&&href.length>1&&"#"+$location.path().substr(0,href.length)==href)return $this.addClass("active"),$this.closest("ul").hasClass("dropdown-menu")&&$this.closest("ul").prev("a").addClass("active"),!1}),$("button.navbar-toggle").not(".collapsed").click()}),$rootScope.addToBCQueue=function(newBcs){var cq={};cq.date=new Date,cq.printed=!1,cq.bcs=[],$rootScope.aq.length||$rootScope.aq.push(cq);for(var cqExists=!1,i=0;i<$rootScope.aq.length;i++)if(!$rootScope.aq[i].printed){cq=$rootScope.aq[i],cqExists=!0;break}cqExists||$rootScope.aq.unshift(cq),newBcs.forEach(function(x){cq.bcs.push(x)}),localStorage.setItem("lbBarcodeInfo",JSON.stringify($rootScope.aq)),$rootScope.toggleView=!0},$rootScope.printFromBCQueue=function(){var skipCols=0,cq=this.q;this.pblSkipRows&&(skipCols+=4*this.pblSkipRows),this.pblSkipCols&&(skipCols+=this.pblSkipCols),cq.bcs&&cq.bcs.length>0&&(cq.date=new Date,cq.printed=!0,localStorage.setItem("lbBarcodeInfo",JSON.stringify($rootScope.aq)),$rootScope.toggleView=!1,window.location="apps/getlabelsku?codes="+encodeURIComponent(cq.bcs)+"&s="+skipCols)},$rootScope.pblSkipRows=0,$rootScope.pblSkipCols=0,$rootScope.toggleView=!1,$rootScope.aq=[],$rootScope.cq={};var initBarcodeCtrl=function(){var barcodeInfo=JSON.parse(localStorage.getItem("lbBarcodeInfo"));barcodeInfo&&barcodeInfo.length>0&&(barcodeInfo.length>=4?$rootScope.aq=barcodeInfo.splice(0,4):$rootScope.aq=barcodeInfo)};initBarcodeCtrl()}).filter("abs",function(){return function(val){return Math.abs(val)}}).directive("editform",function($rootScope){return{templateUrl:function(elem,attr){return $rootScope.globals&&$rootScope.globals.currentUser&&$rootScope.globals.currentUser.ctrlid<=attr.limit?"/resources/ng-templates/admin/inv/forms/"+attr.type+".html"+versionCtrl:"/resources/ng-templates/empty.html"}}}).controller("defaultRouteCtrl",defaultCtrlr).controller("addPurchaseCtrl",["$scope","$http","$filter","$rootScope","$uibModal",addPurchaseCtrlr]).controller("addPacketCtrl",["$scope","$http","$routeParams","driverMode","$uibModal","$rootScope",addPacketCtrlr]).controller("addPplCtrl",["$scope","$http","$filter","$rootScope","$compile",addPplCtrlr]).controller("addProductsCtrl",["$scope","$http","$rootScope","$filter",addProductsCtrlr]).controller("addStrainsCtrl",["$scope","$http","$filter","$rootScope",addStrainsCtrlr]).controller("addCategoryCtrl",["$scope","$http","$filter","$rootScope",addCategoryCtrlr]).controller("addBoxInvCtrl",["$scope","$http","$routeParams",addBoxInvCtrlr]).controller("shopInvCtrl",["$scope","$http","$rootScope","$filter",shopInvCtrlr]).controller("statsCtrl",["$scope","$http","$filter","$uibModal","$rootScope",statsCtrlr]).controller("returnsCtrl",["$scope","$http","$rootScope",returnsCtrlr]).controller("bulkAssignCtrl",["$scope","$http","$rootScope",bulkAssignCtrlr]).controller("barCodeCtrl",["$scope","$http","$rootScope",barCodeCtrlr]).controller("logCtrl",["$scope","$http","$rootScope",logCtrlr]).controller("invAlertCtrl",["$scope","$http","$rootScope",invAlertCtrlr]).controller("miscReportCtrl",["$scope","$http","$rootScope",miscReportCtrlr]).controller("stockTakeCtrl",["$scope","$http","$rootScope","$timeout",stockTakeCtrlr]).controller("ModalSalesInfoCtrl",["$scope","$uibModalInstance","modalScope","$http","$filter","$rootScope",ModalSalesInfoCtrlr]);
//# sourceMappingURL=admin-comb.min.js.map